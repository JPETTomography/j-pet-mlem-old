Notebook[{
Cell[BoxData[
 RowBox[{"<<", " ", 
  "FileNameJoin[{NotebookDirectory[],\"detector.m\"}]"}]], "Input",
 CellChangeTimes->{{3.580806228792144*^9, 3.580806238276654*^9}, 
   3.591720730690607*^9}],

Cell[BoxData[
 RowBox[{"SetDirectory", "[", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<..\>\"", ",", 
     "\"\<pubs\>\"", ",", "\"\<figures\>\""}], "}"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.5917207412201223`*^9, 3.5917207446741962`*^9}, {
  3.5917283461393623`*^9, 3.5917283479273376`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"s", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y_", ",", "z_"}], "}"}], ",", "R_", ",", "L_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"low", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"1", "/", "2"}], " ", "L"}], "+", "z"}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "-", "y"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "L"}], "/", "2"}], "+", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "+", "y"}], ")"}]}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"up", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"L", "/", "2"}], "-", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "-", "y"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"L", "/", "2"}], "+", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "+", "y"}], ")"}]}]}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ArcTan", "[", "up", "]"}], "-", 
       RowBox[{"ArcTan", "[", "low", "]"}]}], ")"}], "/", "Pi"}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"deltaE", "=", 
  RowBox[{
   RowBox[{"toProjectionSpaceTheta", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"y", ",", "z", ",", "\[Theta]"}], "}"}], ",", "R"}], "]"}], "-", 
   RowBox[{"toProjectionSpaceTheta", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", "R"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.580806276466812*^9, 3.580806343387549*^9}}],

Cell[BoxData[
 RowBox[{"deltaE", "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"y", "\[Rule]", 
     RowBox[{"ty", "+", "dy"}]}], ",", 
    RowBox[{"z", "\[Rule]", 
     RowBox[{"tz", "+", "dz"}]}], ",", 
    RowBox[{"\[Theta]", "\[Rule]", 
     RowBox[{"t\[Theta]", "+", "\[Phi]"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.580806347588883*^9, 3.580806399067072*^9}}],

Cell[BoxData[
 RowBox[{"%", "+", 
  RowBox[{
   RowBox[{"O", "[", "\[Phi]", "]"}], "^", "3"}]}]], "Input",
 CellChangeTimes->{{3.580806410767968*^9, 3.580806416160048*^9}}],

Cell[BoxData[
 RowBox[{"%", "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.58080641961515*^9, 3.580806422239698*^9}}],

Cell[BoxData[
 RowBox[{"%", "//", "Normal"}]], "Input",
 CellChangeTimes->{{3.580806467999599*^9, 3.580806470171176*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"oVec", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dy_", ",", "dz_"}], "}"}], ",", "R_"}], "]"}], ":=", 
  RowBox[{"{", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{"dy", "+", "ty", " ", "-", "R"}], ")"}]}], " ", 
     RowBox[{
      RowBox[{"Tan", "[", "t\[Theta]", "]"}], "/", 
      RowBox[{
       RowBox[{"Cos", "[", "t\[Theta]", "]"}], "^", "2"}]}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{"dy", "+", "ty", "+", "R"}], ")"}]}], 
     RowBox[{
      RowBox[{"Tan", "[", "t\[Theta]", "]"}], "/", 
      RowBox[{
       RowBox[{"Cos", "[", "t\[Theta]", "]"}], "^", "2"}]}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"(", 
        RowBox[{"dy", "+", "ty"}], ")"}]}], "/", 
      RowBox[{"Cos", "[", "t\[Theta]", "]"}]}], 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", 
        RowBox[{
         RowBox[{"Tan", "[", "t\[Theta]", "]"}], "^", "2"}]}]}], ")"}]}]}], 
   "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"aVec", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dy_", ",", "dz_"}], "}"}], ",", "R_"}], "]"}], ":=", 
  RowBox[{"{", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{"dy", "+", "ty", " ", "-", "R"}], ")"}]}], "/", 
     RowBox[{
      RowBox[{"Cos", "[", "t\[Theta]", "]"}], "^", "2"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{"dy", "+", "ty", "+", "R"}], ")"}]}], "/", 
     RowBox[{
      RowBox[{"Cos", "[", "t\[Theta]", "]"}], "^", "2"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"-", "2"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"dy", "+", "ty"}], ")"}], "/", 
      RowBox[{"Cos", "[", "t\[Theta]", "]"}]}], " ", 
     RowBox[{"Tan", "[", "t\[Theta]", "]"}]}]}], "\[IndentingNewLine]", 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bVec", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dy_", ",", "dz_"}], "}"}], ",", "R_"}], "]"}], ":=", 
  RowBox[{"{", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dz", "-", 
     RowBox[{"dy", " ", 
      RowBox[{"Tan", "[", "t\[Theta]", "]"}]}]}], ",", "\[IndentingNewLine]", 
    
    RowBox[{"dz", "-", 
     RowBox[{"dy", " ", 
      RowBox[{"Tan", "[", "t\[Theta]", "]"}]}]}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"-", "2"}], " ", 
     RowBox[{"dy", "/", 
      RowBox[{"Cos", "[", "t\[Theta]", "]"}]}]}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.580814042481323*^9, 3.580814120119498*^9}, {
  3.580814207948069*^9, 3.580814389879936*^9}, {3.58082995264052*^9, 
  3.580829952952257*^9}, {3.580830065784848*^9, 3.580830067768176*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeGaussian", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sz_", ",", "sl_", ",", "\[Eta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", "R_"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "o", ",", "b", ",", "a", ",", "ic", ",", "dy", ",", "dz", ",", "f"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ic", "=", 
      RowBox[{"iC", "[", 
       RowBox[{"{", 
        RowBox[{"sz", ",", "sl", ",", "\[Eta]"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"o", "=", 
      RowBox[{
       RowBox[{"bVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{"bVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", " ", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"aVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", " ", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"1", "/", "2"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"b", ".", "ic", ".", "b"}], " ", "-", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"b", ".", "ic", ".", "a"}], ")"}], "^", "2"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"a", ".", "ic", ".", "a"}], "+", 
               RowBox[{"2", " ", 
                RowBox[{"o", ".", "ic", ".", "b"}]}]}], " ", ")"}]}]}], ")"}],
           "//", "Simplify"}], ")"}]}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dy", ",", "dz"}], "}"}], ",", 
       RowBox[{"f", " ", "//", "Evaluate"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.580814586417462*^9, 3.580814667750329*^9}, {
  3.580814711279639*^9, 3.580814766554733*^9}, {3.580814798302453*^9, 
  3.58081483308191*^9}, {3.580828354380329*^9, 3.580828434286326*^9}, {
  3.58082846671508*^9, 3.580828665143025*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeGaussian1", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sz_", ",", "sl_", ",", "\[Eta]_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", "R_"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "o", ",", "b", ",", "a", ",", "ic", ",", "dy", ",", "dz", ",", "f"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ic", "=", 
      RowBox[{"iC", "[", 
       RowBox[{"{", 
        RowBox[{"sz", ",", "sl", ",", "\[Eta]"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"o", "=", 
      RowBox[{
       RowBox[{"bVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{"bVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", " ", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"aVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", " ", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"1", "/", "2"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"b", ".", "ic", ".", "b"}], " ", ")"}], "//", "Simplify"}],
          ")"}]}], "//", "N"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dy", ",", "dz"}], "}"}], ",", 
       RowBox[{"f", " ", "//", "Evaluate"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.581082007945564*^9, 3.581082016448655*^9}}],

Cell[BoxData[
 RowBox[{"g", "=", 
  RowBox[{"makeGaussian", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10.", ",", "50.", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"300", ",", "0", ",", 
      RowBox[{"15", " ", "Degree"}]}], "}"}], ",", "450"}], "]"}]}]], "Input",
 
 CellChangeTimes->{{3.580814670505175*^9, 3.580814688906765*^9}, {
   3.580814779716079*^9, 3.580814780056293*^9}, {3.580814861770636*^9, 
   3.580814865622487*^9}, 3.580828507734313*^9, 3.580828563966299*^9}],

Cell[BoxData[
 RowBox[{"g1", "=", 
  RowBox[{"makeGaussian1", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"10.", ",", "50.", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"300", ",", "0", ",", 
      RowBox[{"15", " ", "Degree"}]}], "}"}], ",", "450"}], "]"}]}]], "Input",
 
 CellChangeTimes->{{3.581082044990388*^9, 3.581082049499898*^9}}],

Cell[BoxData[
 RowBox[{"g", "[", 
  RowBox[{"0", ",", "0"}], "]"}]], "Input",
 CellChangeTimes->{{3.580829217349854*^9, 3.580829219134877*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeEventApproximation", "[", 
   RowBox[{"s_", ",", 
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "t\[Theta]_"}], "}"}], ",", "R_"}], 
   "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "dy", ",", "dz", ",", "g", ",", "\[IndentingNewLine]", "ic", ",", "o", 
      ",", "a", ",", "b", ",", "norm", ",", "expr"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ic", "=", 
      RowBox[{"iC", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"o", "=", 
      RowBox[{
       RowBox[{"oVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{
       RowBox[{"aVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"b", "=", 
      RowBox[{
       RowBox[{"bVec", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], "//", 
       "Evaluate"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"norm", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"a", ".", "ic", ".", "a"}], "+", 
         RowBox[{"2", " ", 
          RowBox[{"o", ".", "ic", ".", "b"}]}]}], ")"}], "//", "Evaluate"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"g", "=", 
      RowBox[{"makeGaussian", "[", 
       RowBox[{"s", ",", 
        RowBox[{"{", 
         RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", "R"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"expr", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"Det", "[", "ic", "]"}], "/", "norm"}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"2", 
          RowBox[{"Pi", "^", "2"}]}], ")"}]}], " ", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         RowBox[{"g", "[", 
          RowBox[{"dy", ",", "dz"}], "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dy", ",", "dz"}], "}"}], ",", 
       RowBox[{"expr", "//", "Evaluate"}]}], "]"}]}]}], "  ", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.580827968088982*^9, 3.58082807627794*^9}, {
   3.580828108982227*^9, 3.580828193977406*^9}, {3.580828231980529*^9, 
   3.580828244130415*^9}, {3.580828282589646*^9, 3.580828330952733*^9}, {
   3.580828683909674*^9, 3.580828726021602*^9}, {3.58082878465441*^9, 
   3.580828865644585*^9}, {3.580828912187963*^9, 3.58082894111645*^9}, {
   3.580828974177183*^9, 3.580829033364306*^9}, {3.580829068440352*^9, 
   3.580829088095833*^9}, {3.580829151651523*^9, 3.580829154828579*^9}, 
   3.580829284177495*^9, {3.580829447723049*^9, 3.580829459026464*^9}, {
   3.580829604328114*^9, 3.580829607334389*^9}, {3.58108225052757*^9, 
   3.58108228830429*^9}, 3.581240295099304*^9, {3.583220880994773*^9, 
   3.583220881815271*^9}}],

Cell[BoxData[{
 RowBox[{"resolution", "=", 
  RowBox[{"{", 
   RowBox[{"10", ",", "63", ",", "0"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"event", "=", 
  RowBox[{"{", 
   RowBox[{"300", ",", "0", ",", 
    RowBox[{"45", " ", "Degree"}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.581082923815993*^9, 3.581082941780651*^9}, {
  3.581224736811886*^9, 3.581224738478572*^9}}],

Cell[BoxData[
 RowBox[{"ev", "=", 
  RowBox[{"makeEventApproximation", "[", 
   RowBox[{"resolution", ",", "event", ",", "450"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.58082905180607*^9, 3.580829060684598*^9}, {
  3.580829270564855*^9, 3.580829271088014*^9}, {3.580829779914868*^9, 
  3.580829780086618*^9}, {3.581082948325293*^9, 3.581082962166095*^9}}],

Cell[BoxData[
 RowBox[{"ev", "[", 
  RowBox[{"0", ",", "0"}], "]"}]], "Input",
 CellChangeTimes->{{3.581082964630907*^9, 3.581082966269052*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"dz", ",", "dy", ",", "tan"}], "]"}]], "Input",
 CellChangeTimes->{{3.581083133629967*^9, 3.581083138973037*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeErrorFunction", "[", 
   RowBox[{"s_", ",", 
    RowBox[{"{", 
     RowBox[{"ty_", ",", "tz_", ",", "ttheta_"}], "}"}], ",", "R_"}], "]"}], ":=",
   " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "dy", ",", "dz", ",", "f", ",", "err", ",", "true", ",", "tan", ",", 
      "meas", ",", "ic"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ic", "=", 
      RowBox[{"iC", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"true", "=", 
      RowBox[{"toProjectionSpaceTan", "[", "    ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ty", "+", "dy"}], ",", 
          RowBox[{"tz", "+", "dz"}], ",", "tan"}], "}"}], ",", "R"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"meas", "=", 
      RowBox[{"toProjectionSpaceTheta", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ty", ",", "tz", ",", "ttheta"}], "}"}], ",", "R"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"err", "=", " ", 
      RowBox[{"true", "-", "meas"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dy", ",", "dz", ",", "tan"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "2"}], 
           RowBox[{"err", ".", "ic", ".", "err"}]}], "]"}], 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{"Det", "[", "ic", "]"}], "]"}], "/", 
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"2", " ", "Pi"}], "]"}], "^", "3"}]}]}], " ", "//", 
        "Evaluate"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.579084935126416*^9, 3.579084936062737*^9}, {
   3.579091132967556*^9, 3.579091135004557*^9}, {3.579091383241335*^9, 
   3.579091384853859*^9}, 3.579267367138588*^9, {3.581082403184537*^9, 
   3.581082468442271*^9}, {3.581082505124406*^9, 3.581082639227758*^9}, {
   3.581082769109159*^9, 3.581082789640624*^9}, {3.581083076273564*^9, 
   3.581083090425096*^9}, {3.581083216567404*^9, 3.581083234619629*^9}, {
   3.581083277841239*^9, 3.581083491476389*^9}, {3.581083577582748*^9, 
   3.581083592851644*^9}, {3.581085759894987*^9, 3.581085824937086*^9}, {
   3.581085902076294*^9, 3.581085903483661*^9}, 3.581086071206743*^9, 
   3.581089919738193*^9}],

Cell[BoxData[
 RowBox[{"ef", "=", 
  RowBox[{"makeErrorFunction", "[", 
   RowBox[{"resolution", ",", "event", ",", "450"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581083005857581*^9, 3.581083055731333*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.581083057448637*^9, 3.581083062210758*^9}, {
  3.581085977129204*^9, 3.581086001044463*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeP", "[", 
   RowBox[{"s_", ",", "meas_", ",", "R_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"f", ",", "ic", ",", "dy", ",", "dz", ",", "expr", ",", "g"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"f", "=", 
      RowBox[{"makeErrorFunction", "[", 
       RowBox[{"s", ",", "meas", ",", "R"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dy", ",", "dz"}], "}"}], ",", 
        RowBox[{
         RowBox[{"\[Pi]", "^", 
          RowBox[{"(", 
           RowBox[{"-", "1"}], ")"}]}], 
         RowBox[{"NIntegrate", "[", 
          RowBox[{"expr", ",", 
           RowBox[{"{", 
            RowBox[{"\[Theta]", ",", 
             RowBox[{
              RowBox[{"-", "Pi"}], "/", "2"}], ",", " ", 
             RowBox[{"Pi", "/", "2"}]}], "}"}]}], "]"}]}]}], "]"}], "/.", 
      RowBox[{"expr", "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"dy", ",", "dz", ",", 
           RowBox[{"Tan", "[", "\[Theta]", "]"}]}], "]"}], "//", "Evaluate"}],
         ")"}]}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.579085022988882*^9, 3.579085184981244*^9}, {
   3.57908530003073*^9, 3.57908533776946*^9}, {3.57908537855304*^9, 
   3.579085415089225*^9}, {3.579085458116442*^9, 3.579085543345108*^9}, {
   3.57908694746663*^9, 3.57908697235166*^9}, {3.579091362161657*^9, 
   3.579091363774957*^9}, {3.579091402896015*^9, 3.579091404868285*^9}, 
   3.57926736714297*^9, {3.581082719751286*^9, 3.581082744968654*^9}, {
   3.581082797993633*^9, 3.581082907784507*^9}, {3.581082992673132*^9, 
   3.581082994357607*^9}, {3.581083046442569*^9, 3.581083047525822*^9}, {
   3.581086106468789*^9, 3.581086310314184*^9}, {3.581087295098851*^9, 
   3.581087299189613*^9}, {3.581087379585532*^9, 3.581087518108889*^9}, {
   3.581087648665723*^9, 3.581087677083556*^9}, {3.581087821503526*^9, 
   3.581087887864302*^9}, {3.581089550797629*^9, 3.581089580788806*^9}, {
   3.581090172469488*^9, 3.581090212909186*^9}}],

Cell[BoxData[
 RowBox[{"p", "=", 
  RowBox[{"makeP", "[", 
   RowBox[{"resolution", ",", "event", ",", "450"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581082909828015*^9, 3.581082913543292*^9}, {
  3.581082972773314*^9, 3.581082984012999*^9}, {3.581086085089074*^9, 
  3.581086085298954*^9}}],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ev", "[", 
      RowBox[{"10", ",", "z"}], "]"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{"10", ",", "z"}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"z", ",", 
     RowBox[{"-", "50"}], ",", "50"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.581090271117813*^9, 3.581090324425819*^9}, {
  3.5812250536884613`*^9, 3.581225055075964*^9}}],

Cell[BoxData[
 RowBox[{"g1", "[", 
  RowBox[{"dy", ",", "dz"}], "]"}]], "Input",
 CellChangeTimes->{{3.581090400031591*^9, 3.581090405232525*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"drawDetector", "[", 
   RowBox[{"{", 
    RowBox[{"R_", ",", "L_"}], "}"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "L"}], "/", "2"}], ",", "R"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"L", "/", "2"}], ",", "R"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "L"}], "/", "2"}], ",", 
           RowBox[{"-", "R"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"L", "/", "2"}], ",", 
           RowBox[{"-", "R"}]}], "}"}]}], "}"}], "]"}]}], "}"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.579147607808497*^9, 3.579147716718827*^9}, 
   3.579267367041969*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"drawEvent", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y_", ",", "z_", ",", "\[Theta]_"}], "}"}], ",", "R_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"zu", ",", "zd", ",", "dl", ",", "m"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"zu", ",", "zd", ",", "dl"}], "}"}], "=", " ", 
      RowBox[{"toProjectionSpaceTheta", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"y", ",", "z", ",", "\[Theta]"}], "}"}], ",", "R"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"zu", ",", "R"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"zd", ",", 
            RowBox[{"-", "R"}]}], "}"}]}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Red", ",", 
         RowBox[{"PointSize", "[", "0.015", "]"}], ",", 
         RowBox[{"Point", "[", 
          RowBox[{"{", 
           RowBox[{"z", ",", "y"}], "}"}], "]"}]}], "}"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.58109360753125*^9, 3.581093608742715*^9}}],

Cell[BoxData[
 RowBox[{"<<", "FileNameJoin[{NotebookDirectory[],\"ellipse.m\"}]"}]], "Input",
 CellChangeTimes->{{3.581182077931497*^9, 3.581182096637479*^9}, {
  3.591720757746666*^9, 3.591720762247929*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"coeffs", "[", 
   RowBox[{"form_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_"}], "}"}]}], "]"}], ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Coefficient", "[", 
     RowBox[{"form", ",", 
      RowBox[{"x", "^", "2"}]}], "]"}], ",", 
    RowBox[{"Coefficient", "[", 
     RowBox[{"form", ",", 
      RowBox[{"y", "^", "2"}]}], "]"}], ",", 
    RowBox[{
     RowBox[{"Coefficient", "[", 
      RowBox[{"form", ",", 
       RowBox[{"x", " ", "y"}]}], "]"}], "/", "2"}]}], "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"caseStudy", "[", 
   RowBox[{"s_", ",", "meas_", ",", "R_", ",", "L_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "el", ",", "g", ",", "y", ",", "z", ",", "a", ",", "b", ",", "c", ",", 
      RowBox[{"p", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"meas", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"meas", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], ",", "limits", ",", "ev",
       ",", "ep"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"g", "=", 
      RowBox[{"makeGaussian1", "[", 
       RowBox[{"s", ",", "meas", ",", "R"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", "b", ",", "c"}], "}"}], "=", 
      RowBox[{
       RowBox[{"coeffs", "[", 
        RowBox[{
         RowBox[{"g", "[", 
          RowBox[{"y", ",", "z"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"z", ",", "y"}], "}"}]}], "]"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"el", "=", 
      RowBox[{"reconstructEllipse", "[", 
       RowBox[{"a", ",", "b", ",", "c", ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"limits", "=", 
      RowBox[{"ellipseLimits", "[", 
       RowBox[{"a", ",", "b", ",", "c", ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ev", "=", 
      RowBox[{"makeEventApproximation", "[", 
       RowBox[{"resolution", ",", "meas", ",", "450"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ep", "=", 
      RowBox[{"makeP", "[", 
       RowBox[{"resolution", ",", "meas", ",", "450"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"drawDetector", "[", 
           RowBox[{"{", 
            RowBox[{"R", ",", "L"}], "}"}], "]"}], ",", 
          RowBox[{"drawEvent", "[", 
           RowBox[{"meas", ",", "R"}], "]"}], ",", 
          RowBox[{"ellipse", "[", 
           RowBox[{"p", ",", "a", ",", "b", ",", "c", ",", "1"}], "]"}], ",", 
          
          RowBox[{"ellipse", "[", 
           RowBox[{"p", ",", "a", ",", "b", ",", "c", ",", "3"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"Thin", ",", 
            RowBox[{"ellipseBoundingBox", "[", 
             RowBox[{"a", ",", "b", ",", "c", ",", "3", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"meas", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"meas", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "Gray"}], 
             "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], " ", "limits"}]}], " ", ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "3"}], "}"}], "limits"}]}]}], "}"}],
            "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "3"}], "}"}], " ", "limits"}]}], " ", ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "3"}], "}"}], "limits"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "3"}], "}"}], " ", "limits"}]}], 
             " ", ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "limits"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "1"}], "}"}], "limits"}]}], ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "limits"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "0"}], "}"}], "limits"}]}], ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "0"}], "}"}], "limits"}]}]}], "}"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"p", "-", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "limits"}]}], ",", 
             RowBox[{"p", "+", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"3", ",", "1"}], "}"}], "limits"}]}]}], "}"}], 
           "]"}]}], "\[IndentingNewLine]", "}"}], "//", "Graphics"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{
         RowBox[{"{", "  ", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Plot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"ep", "[", 
                  RowBox[{
                   RowBox[{"q", " ", 
                    RowBox[{"limits", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "z"}], "]"}], ",", 
                 
                 RowBox[{"ev", "[", 
                  RowBox[{
                   RowBox[{"q", " ", 
                    RowBox[{"limits", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "z"}], "]"}]}], 
                "}"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"z", ",", 
                 RowBox[{
                  RowBox[{"-", "3"}], 
                  RowBox[{"limits", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                 RowBox[{"3", 
                  RowBox[{"limits", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"PlotRange", "->", "All"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", 
               RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Plot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"ep", "[", 
                  RowBox[{"y", ",", 
                   RowBox[{"q", " ", 
                    RowBox[{"limits", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", 
                 RowBox[{"ev", "[", 
                  RowBox[{"y", ",", 
                   RowBox[{"q", " ", 
                    RowBox[{"limits", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}], "}"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"y", ",", 
                 RowBox[{
                  RowBox[{"-", "3"}], 
                  RowBox[{"limits", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                 RowBox[{"3", 
                  RowBox[{"limits", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"PlotRange", "->", "All"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", 
               RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}], "//", "Transpose"}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.580476645845137*^9, 3.580476701510421*^9}, {
   3.580476991858084*^9, 3.580477018710421*^9}, {3.58047729578177*^9, 
   3.580477345760888*^9}, {3.580477387624128*^9, 3.580477390212572*^9}, {
   3.580477469623081*^9, 3.580477482761695*^9}, {3.580477809491113*^9, 
   3.580477811780659*^9}, {3.580477844022321*^9, 3.580477884468837*^9}, {
   3.580478023937936*^9, 3.580478070716549*^9}, {3.580478145199458*^9, 
   3.58047815116175*^9}, {3.58047818323432*^9, 3.58047818471356*^9}, {
   3.580478258278011*^9, 3.580478263153411*^9}, {3.58047833838673*^9, 
   3.580478413750334*^9}, {3.580478445730671*^9, 3.580478463229189*^9}, {
   3.580478507228963*^9, 3.580478507542825*^9}, {3.580478700418703*^9, 
   3.58047872100081*^9}, {3.580493442488585*^9, 3.580493473249911*^9}, {
   3.580493583965768*^9, 3.580493599409315*^9}, {3.580493649583082*^9, 
   3.580493673492772*^9}, {3.580493723545005*^9, 3.580493748080782*^9}, {
   3.580493926634753*^9, 3.580493955382031*^9}, {3.580494448156092*^9, 
   3.580494595489041*^9}, {3.580494636724078*^9, 3.580494652047*^9}, 
   3.58049587671991*^9, {3.580496107392704*^9, 3.580496136880799*^9}, {
   3.580547710079002*^9, 3.580547828744976*^9}, {3.580547863385528*^9, 
   3.580547969234432*^9}, {3.580548030893464*^9, 3.580548227151101*^9}, {
   3.580548383722352*^9, 3.580548469701971*^9}, {3.580548818468112*^9, 
   3.580549010480631*^9}, {3.580549111499434*^9, 3.580549120570458*^9}, {
   3.580549481499405*^9, 3.580549524601032*^9}, {3.580549688764797*^9, 
   3.58054974176834*^9}, {3.580549866238693*^9, 3.580549868026314*^9}, {
   3.580550560318267*^9, 3.580550580247934*^9}, {3.580564160535799*^9, 
   3.580564166333306*^9}, {3.580564308143676*^9, 3.580564320835756*^9}, 
   3.581090471739525*^9, {3.581091368775224*^9, 3.581091411563573*^9}, {
   3.581091591389636*^9, 3.581091594013994*^9}, {3.581091652388966*^9, 
   3.581091682113062*^9}, {3.581091863992156*^9, 3.581091899179724*^9}, {
   3.581092335152094*^9, 3.58109264648593*^9}, {3.581092779312936*^9, 
   3.581092815180453*^9}, {3.581092912601888*^9, 3.581092925555288*^9}, {
   3.581094507857797*^9, 3.58109451905642*^9}}],

Cell[BoxData[
 RowBox[{"el", "=", 
  RowBox[{"caseStudy", "[", 
   RowBox[{"resolution", ",", "event", ",", "450", ",", "1000"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.58109141448975*^9, 3.581091454365423*^9}, {
  3.58109149184288*^9, 3.581091501999628*^9}, {3.581091742003775*^9, 
  3.581091749350721*^9}, {3.581091909375582*^9, 3.581091914636834*^9}, {
  3.581092937252622*^9, 3.581092940653386*^9}, {3.5810931410597*^9, 
  3.581093141437654*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"caseStudyList", "[", 
   RowBox[{"s_", ",", "events_", ",", "R_", ",", "L_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "res", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"caseStudy", "[", 
         RowBox[{"s", ",", "#", ",", "R", ",", "L"}], "]"}], "&"}], "/@", 
       "events"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Show", "[", 
        RowBox[{"res", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", 
       RowBox[{"res", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.581093212459556*^9, 3.581093333006776*^9}, {
  3.581093618914168*^9, 3.581093636825441*^9}}],

Cell[BoxData[
 RowBox[{"c300", "=", 
  RowBox[{"caseStudyList", "[", 
   RowBox[{"resolution", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"300", ",", "0", ",", 
        RowBox[{"0", " ", "Degree"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"300", ",", "300", ",", " ", 
        RowBox[{"45", " ", "Degree"}]}], "}"}]}], "}"}], ",", "450", ",", 
    "1000"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581093334905676*^9, 3.581093436136058*^9}, {
  3.581093657285345*^9, 3.581093659186047*^9}, {3.581095684381469*^9, 
  3.58109568929184*^9}, {3.581163852848452*^9, 3.581163856620068*^9}}],

Cell[BoxData[
 RowBox[{"c000", "=", 
  RowBox[{"caseStudyList", "[", 
   RowBox[{"resolution", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", "300"}], ",", 
        RowBox[{"0", "Degree"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", " ", 
        RowBox[{"45", " ", "Degree"}]}], "}"}]}], "}"}], ",", "450", ",", 
    "1000"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581094846867115*^9, 3.581094861856681*^9}, 
   3.581095545404092*^9, {3.581095581756875*^9, 3.58109560964725*^9}, {
   3.581095696058311*^9, 3.581095704868787*^9}, {3.58116376663171*^9, 
   3.581163768976291*^9}, {3.581163825618978*^9, 3.581163833930609*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.581095187355533*^9, 3.581095232054825*^9}, 
   3.581095404217823*^9}],

Cell[BoxData[{
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs000_ev.eps\>\"", ",", 
   RowBox[{"c000", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs000_pl1.eps\>\"", ",", 
   RowBox[{"c000", "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs000_pl2.eps\>\"", ",", 
   RowBox[{"c000", "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.58109526394659*^9, 3.581095293338915*^9}, {
   3.581095406658443*^9, 3.581095425740288*^9}, 3.581095456175659*^9, {
   3.581160177483381*^9, 3.581160178663009*^9}}],

Cell[BoxData[{
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs300_ev.eps\>\"", ",", 
   RowBox[{"c300", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs300_pl1.eps\>\"", ",", 
   RowBox[{"c300", "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<cs300_pl2.eps\>\"", ",", 
   RowBox[{"c300", "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", "\"\<EPS\>\""}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.58109526394659*^9, 3.581095293338915*^9}, {
  3.581095406658443*^9, 3.581095407167835*^9}, {3.581160182182011*^9, 
  3.58116018241331*^9}}],

Cell[BoxData[
 RowBox[{"caseStudy", "[", 
  RowBox[{"resolution", ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", 
     RowBox[{"0", " ", "Degree"}]}], "}"}], " ", ",", "180", ",", "300"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.583220986083836*^9, 3.5832210037525377`*^9}}],

Cell[BoxData[
 RowBox[{"caseStudy", "[", 
  RowBox[{"resolution", ",", 
   RowBox[{"{", 
    RowBox[{"100", ",", "50", ",", 
     RowBox[{"35", " ", "Degree"}]}], "}"}], " ", ",", "180", ",", "300"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.5832210642146397`*^9, 3.583221089285475*^9}, {
  3.583221134246283*^9, 3.583221140596925*^9}, {3.583221182915856*^9, 
  3.583221183497694*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"z", ",", 
       RowBox[{"ev", "[", 
        RowBox[{"10", ",", "z"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"z", ",", 
       RowBox[{"-", "50"}], ",", "50"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5812250927052307`*^9, 3.5812251128894176`*^9}, {
  3.581225211623848*^9, 3.5812252292871313`*^9}}],

Cell[BoxData[
 RowBox[{"r", "=", 
  RowBox[{"FindFit", "[", 
   RowBox[{"data", ",", 
    RowBox[{"c", " ", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "a"}], "/", "2"}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"z", "-", "m"}], ")"}], "^", "2"}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"a", ",", "m", ",", "c"}], "}"}], ",", "z"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581225115412026*^9, 3.5812251903248663`*^9}, {
  3.581225331086813*^9, 3.581225333507876*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"c", " ", 
   RowBox[{"Exp", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "a"}], "/", "2"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"x", "-", "m"}], ")"}], "^", "2"}]}], "]"}]}], "/.", "r", 
  " "}]], "Input",
 CellChangeTimes->{3.5812252936774406`*^9}],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ev", "[", 
        RowBox[{"10", ",", "z"}], "]"}], ",", 
       RowBox[{"c", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "a"}], "/", "2"}], 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"z", "-", "m"}], ")"}], "^", "2"}]}], "]"}]}]}], "}"}], "/.",
      "r"}], " ", "//", "Evaluate"}], ",", 
   RowBox[{"{", 
    RowBox[{"z", ",", 
     RowBox[{"-", "50"}], ",", "50"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.581225202887925*^9, 3.58122520458151*^9}, {
  3.5812252354425507`*^9, 3.581225352049324*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeGaussian", "[", 
    RowBox[{"resolution", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "450"}], "]"}], "[", 
   RowBox[{"y", ",", "0"}], "]"}], "//", "Chop"}]], "Input",
 CellChangeTimes->{{3.581225380478642*^9, 3.581225399206609*^9}, {
  3.581225467945018*^9, 3.581225468284843*^9}, {3.581229101850678*^9, 
  3.581229110509272*^9}, {3.581237265127614*^9, 3.5812372674343452`*^9}, {
  3.581237465172761*^9, 3.5812374667219143`*^9}, {3.5812379010977488`*^9, 
  3.581237920167967*^9}}],

Cell[BoxData[
 RowBox[{"%", "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.5812374760622177`*^9, 3.581237478544703*^9}}],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     FractionBox[
      RowBox[{
       RowBox[{"405000.`", " ", 
        SuperscriptBox["y", "2"]}], "+", 
       RowBox[{"2.2015621063240114`", " ", 
        SuperscriptBox["y", "4"]}]}], 
      RowBox[{"8.037225`*^8", "+", 
       RowBox[{"4369.`", " ", 
        SuperscriptBox["y", "2"]}]}]], ",", 
     FractionBox[
      RowBox[{
       RowBox[{"405000.`", " ", 
        SuperscriptBox["y", "2"]}], "+", 
       RowBox[{"0", " ", "2.2015621063240114`", " ", 
        SuperscriptBox["y", "4"]}]}], 
      RowBox[{"8.037225`*^8", "+", 
       RowBox[{"0", " ", "4369.`", " ", 
        SuperscriptBox["y", "2"]}]}]]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"y", ",", 
     RowBox[{"-", "50"}], ",", "50"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.5812378068173513`*^9, 3.5812378675144863`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeGaussian1", "[", 
     RowBox[{"resolution", ",", 
      RowBox[{"{", 
       RowBox[{"0.0", ",", "0.0", ",", "0.0"}], "}"}], ",", "450"}], "]"}], 
    "[", 
    RowBox[{"y", ",", "0.0"}], "]"}], "//", "Simplify"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.5812256637408257`*^9, 3.581225684541746*^9}, {
  3.581237241710907*^9, 3.581237318691471*^9}}],

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"0.000504", "\[Equal]", 
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{"2", " ", 
       RowBox[{"s", "^", "2"}]}], ")"}]}]}], ",", "s"}], "]"}]], "Input",
 CellChangeTimes->{{3.581237330236086*^9, 3.5812373912178297`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeGaussian", "[", 
    RowBox[{"resolution", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "450"}], "]"}], "[", 
   RowBox[{"y", ",", "z"}], "]"}], "//", "Chop"}]], "Input",
 CellChangeTimes->{{3.581237561621141*^9, 3.581237571399716*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{"5.0390526581002774`*^-6", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"436900.`", " ", 
        SuperscriptBox["y", "4"]}], "+", 
       RowBox[{"1.5876`*^6", " ", 
        SuperscriptBox["y", "2"], " ", 
        RowBox[{"(", 
         RowBox[{"50625.`", "\[VeryThinSpace]", "+", 
          SuperscriptBox["z", "2"]}], ")"}]}], "+", 
       RowBox[{"1.5752961`*^7", " ", 
        SuperscriptBox["z", "2"], " ", 
        RowBox[{"(", 
         RowBox[{"101250.`", "\[VeryThinSpace]", "+", 
          SuperscriptBox["z", "2"]}], ")"}]}]}], ")"}]}], 
    RowBox[{
     RowBox[{"4369.`", " ", 
      SuperscriptBox["y", "2"]}], "+", 
     RowBox[{"7938.`", " ", 
      RowBox[{"(", 
       RowBox[{"101250.`", "\[VeryThinSpace]", "+", 
        SuperscriptBox["z", "2"]}], ")"}]}]}]], 
   RowBox[{"s", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"y_", ",", "z_"}], "}"}], ",", "R_", ",", "L_"}], "]"}]}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"low", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"1", "/", "2"}], " ", "L"}], "+", "z"}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "-", "y"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "L"}], "/", "2"}], "+", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "+", "y"}], ")"}]}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"up", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"L", "/", "2"}], "-", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "-", "y"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"L", "/", "2"}], "+", "z"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"R", "+", "y"}], ")"}]}]}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ArcTan", "[", "up", "]"}], "-", 
       RowBox[{"ArcTan", "[", "low", "]"}]}], ")"}], "/", "Pi"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.587095073766078*^9, 3.587095073882822*^9}}],

Cell[BoxData[
 RowBox[{"ic", "=", 
  RowBox[{"iC", "[", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["\[Sigma]", "z"], ",", 
     SubscriptBox["\[Sigma]", "l"], ",", "0"}], "}"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581237923359001*^9, 3.581237959013619*^9}, {
  3.581240223490508*^9, 3.581240269361205*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeGaussian", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      SubscriptBox["\[Sigma]", "z"], ",", 
      SubscriptBox["\[Sigma]", "l"], ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", "R"}], "]"}], 
  "[", 
  RowBox[{"dy", ",", "dz"}], "]"}]], "Input",
 CellChangeTimes->{{3.5812397950303087`*^9, 3.581239846037263*^9}, {
  3.581240257699778*^9, 3.581240261154381*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"%", "//", "Simplify"}], " ", "//", "Chop"}]], "Input",
 CellChangeTimes->{{3.581239825675729*^9, 3.5812398282204247`*^9}, {
  3.5812398720580597`*^9, 3.5812398742564573`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bVec", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], ".", "ic", ".", 
  RowBox[{"bVec", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.581240284331361*^9, 3.581240327394804*^9}}],

Cell[BoxData[
 RowBox[{"%", "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.581240329809723*^9, 3.581240332092944*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], ".", "ic", ".", 
   RowBox[{"aVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}]}], "//", 
  "Simplify"}]], "Input",
 CellChangeTimes->{{3.581240423618877*^9, 3.58124043687825*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"aVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], ".", "ic", ".", 
   RowBox[{"aVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}]}], "//", 
  "Simplify"}]], "Input",
 CellChangeTimes->{{3.581240440269889*^9, 3.581240444646646*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}], ".", "ic", ".", 
   RowBox[{"oVec", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ty", ",", "tz", ",", "t\[Theta]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"dy", ",", "dz"}], "}"}], ",", "R"}], "]"}]}], "//", 
  "Simplify"}]], "Input",
 CellChangeTimes->{{3.5812404569562902`*^9, 3.5812404572839518`*^9}}]
},
WindowSize->{1406, 1261},
WindowMargins->{{61, Automatic}, {Automatic, 25}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->"Default.nb"
]

