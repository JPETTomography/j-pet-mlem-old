(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     40155,       1121]
NotebookOptionsPosition[     37073,       1020]
NotebookOutlinePosition[     37410,       1035]
CellTagsIndexPosition[     37367,       1032]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"SetDirectory", "[", "\"\<~/PET/data\>\"", "]"}]}]], "Input",
 CellChangeTimes->{{3.56086390864838*^9, 3.560863916922752*^9}}],

Cell[BoxData["\<\"/home/pbialas/PET/data\"\>"], "Output",
 CellChangeTimes->{3.560863918650333*^9, 3.560932587674354*^9, 
  3.561005062200177*^9, 3.561034240112217*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Zip", "[", 
   RowBox[{"a_List", ",", "b_List"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"b", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Zip", "[", 
   RowBox[{"a_List", ",", "b_List", ",", "c_List"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"b", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"c", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Zip", "[", 
   RowBox[{"a_List", ",", "b_List", ",", "c_List", ",", "d_List"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"b", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"c", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"d", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.560865603919788*^9, 3.560865665813969*^9}, 
   3.561005368894468*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Intersect", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1_", ",", "p2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "sol", ",", "line"}], "}"}], ",", 
    RowBox[{
     RowBox[{"line", "=", 
      RowBox[{"(", 
       RowBox[{"p1", "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"p2", "-", "p1"}], ")"}], "t"}]}], " ", ")"}]}], ";", " ", 
     RowBox[{"sol", "=", 
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "b"}], "}"}], ".", "line"}], "\[Equal]", "c"}], 
        ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tt", "=", 
      RowBox[{"t", "/.", "sol"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "tt", "]"}], ">", "0"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"tt", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", "0"}], " ", "&&",
         " ", 
        RowBox[{
         RowBox[{"tt", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "<", "1"}]}], ",", 
       RowBox[{"line", "/.", " ", 
        RowBox[{"sol", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.560935234174648*^9, 3.560935278166339*^9}, {
  3.560936460953024*^9, 3.56093650012538*^9}, {3.560936538605507*^9, 
  3.560936641235456*^9}, {3.560936678382938*^9, 3.560936682607818*^9}, {
  3.560936717784144*^9, 3.560936764427768*^9}, {3.560940639480466*^9, 
  3.560940769566799*^9}, {3.560941946309429*^9, 3.560941950977892*^9}, {
  3.560941986474211*^9, 3.560941987794152*^9}, {3.560942119675813*^9, 
  3.560942120071085*^9}, {3.560943031794495*^9, 3.560943095103719*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Intersect", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", 
     RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.560936643332926*^9, 3.560936688183081*^9}, 
   3.560941930999883*^9}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{
  3.560941952250458*^9, {3.560941989204297*^9, 3.560941991542133*^9}, 
   3.560943097407414*^9, 3.56100470777954*^9, 3.561034240490257*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"poly", "=", 
  RowBox[{"Polygon", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.560942860558664*^9, 3.56094286175219*^9}}],

Cell[BoxData[
 RowBox[{"Polygon", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1"}], "}"}]}], "}"}], "]"}]], "Output",
 CellChangeTimes->{3.56094286262911*^9, 3.560943098269813*^9, 
  3.561004708405181*^9, 3.561034240498874*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Clear", "[", "rotate", "]"}]], "Input",
 CellChangeTimes->{{3.560941751517542*^9, 3.560941754973546*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotate", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_"}], "}"}], ",", 
    RowBox[{"phi_", " ", ":", " ", "0.0"}], " ", ",", " ", 
    RowBox[{"center_", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"RotationMatrix", "[", "phi", "]"}], ".", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y"}], "}"}], "-", "center"}], ")"}]}], "+", 
   "center"}]}]], "Input",
 CellChangeTimes->{{3.560941116810582*^9, 3.560941261148641*^9}, {
  3.560941673170031*^9, 3.560941691857122*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.560941264681049*^9, 3.560941267952378*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rotate", "[", 
   RowBox[{
    RowBox[{"Polygon", "[", "p_List", "]"}], ",", 
    RowBox[{"phi_:", "0"}], ",", " ", 
    RowBox[{"center_", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Polygon", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rotate", "[", 
      RowBox[{"#", ",", "phi", ",", "center"}], "]"}], "&"}], "/@", "p"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.560941276694975*^9, 3.560941281915796*^9}, {
  3.560941632224427*^9, 3.560941726666817*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Intersect", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}], ",", 
    RowBox[{"Polygon", "[", "ps_List", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ins", "}"}], ",", 
    RowBox[{
     RowBox[{"ins", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"ps", ",", "2", ",", "1", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Intersect", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "#"}], "]"}], 
         "&"}], "/@", "ins"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "#", "]"}], ">", "0"}], "&"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.560942125482608*^9, 3.560942135884776*^9}, {
  3.560942806358501*^9, 3.560942838517528*^9}, {3.560942898701432*^9, 
  3.560942942489876*^9}, {3.560943119233744*^9, 3.56094313439234*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"eventToLine", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], ",", "phi_"}], "}"}], "]"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Sin", "[", "phi", "]"}], ",", 
    RowBox[{"-", 
     RowBox[{"Cos", "[", "phi", "]"}]}], ",", 
    RowBox[{
     RowBox[{"x", " ", 
      RowBox[{"Sin", "[", "phi", "]"}]}], " ", "-", 
     RowBox[{"y", " ", 
      RowBox[{"Cos", "[", "phi", "]"}]}]}]}], "}"}], "  "}]], "Input",
 CellChangeTimes->{{3.560944010297788*^9, 3.560944152119561*^9}, 
   3.560944304761455*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Sin", "[", "phi", "]"}], ",", 
   RowBox[{"-", 
    RowBox[{"Cos", "[", "phi", "]"}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "y"}], " ", 
     RowBox[{"Cos", "[", "phi", "]"}]}], "+", 
    RowBox[{"x", " ", 
     RowBox[{"Sin", "[", "phi", "]"}]}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.56094430508115*^9, 3.561004722428763*^9, 
  3.561034240885101*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"FaceForm", "[", "]"}], ",", 
    RowBox[{"EdgeForm", "[", "Black", "]"}], ",", "poly", ",", "Red", ",", 
    RowBox[{"PointSize", "[", "0.025", "]"}], ",", 
    RowBox[{"Point", "/@", 
     RowBox[{"Intersect", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "0.25"}], "}"}], ",", "poly"}], "]"}]}]}],
    "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.560943464879246*^9, 3.560943567738065*^9}, {
  3.560943635308453*^9, 3.560943635593394*^9}, {3.560943672611666*^9, 
  3.560943693707742*^9}, {3.560943724499437*^9, 3.560943725531594*^9}, {
  3.560943761604505*^9, 3.560943762419262*^9}}],

Cell[BoxData[
 GraphicsBox[
  {EdgeForm[GrayLevel[0]], FaceForm[None], 
   PolygonBox[{{0, 0}, {1, 0}, {1, 1}, {0, 1}}], 
   {RGBColor[1, 0, 0], PointSize[0.025], PointBox[{1, 0.25}], 
    PointBox[{0, 0.25}]}}]], "Output",
 CellChangeTimes->{
  3.560943488987733*^9, {3.560943525386613*^9, 3.560943568380871*^9}, 
   3.560943636545495*^9, {3.560943682369461*^9, 3.560943694563175*^9}, 
   3.560943726450775*^9, 3.560943763061619*^9, 3.561004723359998*^9, 
   3.561034241229556*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"p1", "=", 
    RowBox[{"rotate", "[", 
     RowBox[{
      RowBox[{"Polygon", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.25", ",", "0.25"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.25"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.75"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.25", ",", "0.75"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{
       RowBox[{"-", "Pi"}], "/", "6"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.25", ",", "0.25"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.561004426985115*^9, 3.561004427075667*^9}, {
  3.561004462812147*^9, 3.561004479794221*^9}, {3.561004513338253*^9, 
  3.561004595974234*^9}, {3.561004627407705*^9, 3.561004627654442*^9}, {
  3.561004669641749*^9, 3.561004684987517*^9}}],

Cell[BoxData[
 RowBox[{"Polygon", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0.25`", ",", "0.25`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.46650635094610965`", ",", "0.125`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.7165063509461096`", ",", "0.5580127018922193`"}], "}"}], ",", 
    
    RowBox[{"{", 
     RowBox[{"0.5`", ",", "0.6830127018922193`"}], "}"}]}], "}"}], 
  "]"}]], "Output",
 CellChangeTimes->{3.561004597889719*^9, 3.561004628244982*^9, 
  3.561004688797742*^9, 3.561004726632669*^9, 3.561034241511944*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"FaceForm", "[", "]"}], ",", 
     RowBox[{"EdgeForm", "[", "Black", "]"}], ",", "p1"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.561004598821999*^9, 3.561004655065071*^9}}],

Cell[BoxData[
 GraphicsBox[
  {EdgeForm[GrayLevel[0]], FaceForm[None], 
   PolygonBox[{{0.25, 0.25}, {0.46650635094610965`, 0.125}, {
    0.7165063509461096, 0.5580127018922193}, {0.5, 0.6830127018922193}}]},
  Frame->True,
  PlotRange->{{0, 1}, {0, 1}}]], "Output",
 CellChangeTimes->{{3.561004617574707*^9, 3.561004656030705*^9}, 
   3.561004688952304*^9, 3.561004727902965*^9, 3.561034241526833*^9},
 ImageCache->GraphicsData["CompressedBitmap", "\<\
eJztXQl0VUXSLoWgM//M+I+CyqIgSFhkAiQgCMOAg7LIJosMBAJJIJCwhBDW
sO8MAQIZFlkDUdkHEWQQcf3VQScqHFCEiLiAbBFEEkLIxpv79au63OBbbt/4
n8mc886Bl9f9ur9bXV1dVV1d/V6XqLGxMSOjxsYNiqrRPjEqITZu0Jga7UYl
GlXl7iC6I9b4H1WD8N5FJC8u458rDi+o8fz+t+rPPeQqvEB7xvem4ckracGw
3jRh70UqND7JOzGTGlXvTPsuFXttE2YbI5s+ja1FlUJaUuvWrY3/reiJFlF0
8KoORrFq6Sq6QhnpU+ipyg9S21l76EKBi5roYBScp93j+9CI5DW0as5Qik4+
SFeK9egovPgPmtR7AE1fuZ5WTBtAf5myn7IKXRQqGMU5dPxAOk0Jq0jV+6fS
zn9ess3TO0tOT/aHkVS3+Xo6bcAXfreaHq83mDJyDDYUXKIjGV/RNYN0b23C
NDAKL+6lsUM30Mk8JSRUlH2SzuQWM8avbGG4SS9HrvxTlPJ4GM3JvEFNNWi4
+s8BVL/NVjpfZNTnfUFTGzaiGSduaIzjBp2YFUJ1Yw/RNYjKtU9ocJ2GNP9L
wfid8ZpDGf2DqVnaGcVuJVL+ecmz8hv15y7j1XjSzD9Q7ehP3E/K+ZgiHg2h
ecaT7rTRJtRGm/LMzRvf/p2mjE6l/8sqZEG3+fybVyljRjSNmTmf5s8ZR50e
qkrtxi2h3efymRv2x5E5p6HB1cOUizaFZyitaXVq/95PtsZxC6eQzr7YloK7
7qUfDE4XZ+2mTrWfok1ni5ie8rfPTjnb8JaZyaXDw4KpbuJRuo6muUcovk4d
ij+Sa6HEe5tQG22CmFqsmfg/9qBFh7Lppstlp6t7REGUd3ItJaw9SXmWpdJE
awjX6fMJwVSpeSplGku28OxW6lijKS05lW9rCG46Khiif5a2D2xCHZNSKKlD
Exq4/SwVuFx+58MfhSVWSubsEMvUZXiWMC9tQm20CTKpLaasV/5M1Rovpa/z
XXa6ynygzan0ibTh2DFa/LP5sDOEQjqT1pzqhr9I6ctnUXy/CEradorybrps
DUHmI+/4NGocMok+u+6i3KMTKKTxTDpxw/98+KOQ7UkFyv7XIKrXPI3OsH5r
Vi8G+q2c74/DfH98iwvFdPlAJHVZkEl5Rk3Ov8Kp5mPT6XieGCOvEOVlhPmn
acekyTT0D2oSmtojO/9UCrX640r6tgD6KYve2vgPOlfgj2zpnZPRn4IfX6d0
fsG3K6lJnUj6JMfC9Gz6qG9tYXp5O7ww+e0qvEj7JkdQYuo6SokPp8mvZd2a
Oa8fh9nrXXT5XZobGUPz1q6leZFdKX6HZfV67R3EhqXwwk4Kr9XQYqb9k3vz
OmWmj6exC9fR+uQY6hy7mb4vsEuuK+8UbRzeh8YvS6PUMYbrk/4N3RC9GaS8
pmO7/kZJ0f1o5P4sKmLu+0C+07ePS//rtu/OXVyF1rcEWik8shJopfcifgZX
OtOneK02EF3wcncJOkujw8WTce9NXKYndnvdb8t4u7JEyy/droJltl3edBv5
MROBiS777UpOtBe9Sn7sk6eJbm2zrk0p+jLxFcve49Vrx0CfQJ//pz7qE1Xd
3ize/V9Ce6BPoE9grQT6GP9Xcl1+fj4tWrSI3nrrLdqlB7FCvQbRa6+9RvXr
16cWLVrQY489RoWFhfSyHtQy9XoXnThxgjp06KDgDhw4oGrbtm1LqampupCp
TN2VK1dozJgxVKVKFVqxYoWiTgLkn332GT3wwAN06dIl2qkHv4Thi4uLadWq
VfTggw/SsGHD6IcffiDZ2KM8fPhwVfq7HnyKei1P77zzDjVu3JjatWtHx44d
u4ubguD7779fDUATeREjf/fdd9SzZ0969NFH6eWXX/41NwWnwXGUdughJzNL
cnJyaPLkyVSpUiVauHChErH/4fbgPiZ3165duvB/ZfibN2/S5s2bqWrVqhQd
HU3nzp0zHezXX3+datWqRTdu3KDtfuDVJ/OZGx9++CE1b96cnnjiCTp06NDv
uW/Xrl1p/nx3oy1mJx8qbC4TCaKioqKoevXqilgQfS+3//LLLxVvzp8/T9v0
eDCb4a9fv05z5sxRMFOnTlXlStx+7NixFBkZqUpb9eBnMTcMeaDatWtT3759
IScPcNOrV6+qZfTxxx/rIs9g5CNHjlCbNm2UTL/33ntVuOnatWsV68GmLXrI
05glWHhYcA899BCtX79eLcyq3B7vw8LCaNOmTbrwUxgegrtkyRK16qBOoFYe
5vbGQNRjc3NzabMe/GTmi+jQbt260cmTJx/hpn369FHzi9ImPeQkRjbQ6Jln
nlHoxlNqcVMs//vuu0/91USewCwRzQqWLF++XLGoNrefPn06Pffcc6r0kh78
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
Z0XgEXr4UTk/vylnBVHv43y/pzv+DdFMiOU=\
\>"]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"nEvents", "=", " ", "500"}], ";"}]], "Input",
 CellChangeTimes->{{3.561004971239971*^9, 3.561004978519202*^9}, 
   3.561005402338734*^9, {3.561007739500054*^9, 3.56100774081775*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"events", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RandomReal", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], ",", "2"}], "]"}], ",", 
       RowBox[{"RandomReal", "[", 
        RowBox[{"2", "Pi"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", "nEvents", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.561004749765226*^9, 3.561004812496829*^9}, {
  3.561004980418847*^9, 3.561004983001588*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lines", "=", " ", 
   RowBox[{"eventToLine", "/@", "events"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.561004814475281*^9, 3.56100483207082*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"inters", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Intersect", "[", 
      RowBox[{"#", ",", "p1"}], "]"}], "&"}], "/@", "lines"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.561004836829566*^9, 3.56100487081842*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lengths", "=", 
   RowBox[{"Length", "/@", "inters"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.561005382925247*^9, 3.561005392820604*^9}, 
   3.561005427619353*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"exp", "=", 
   RowBox[{"Flatten", "/@", 
    RowBox[{"Zip", "[", 
     RowBox[{"events", ",", "lines", ",", "lengths", ",", "inters"}], 
     "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.561005398141016*^9, 3.561005490623746*^9}, {
  3.561007747232767*^9, 3.561007748211479*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"p1", "[", 
  RowBox[{"[", "1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.561005221889271*^9, 3.561005256844308*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0.25`", ",", "0.25`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.46650635094610965`", ",", "0.125`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.7165063509461096`", ",", "0.5580127018922193`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5`", ",", "0.6830127018922193`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.561005225337448*^9, 3.561005257147101*^9}, 
   3.561034242233536*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"out", "=", 
  RowBox[{
  "OpenWrite", "[", "\"\<polygon.test\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Write", "[", 
  RowBox[{"out", ",", "nEvents"}], "]"}], "\n", 
 RowBox[{"Export", "[", 
  RowBox[{"out", ",", 
   RowBox[{"p1", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<Table\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Write", "[", "out", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"out", ",", "exp", ",", "\"\<Table\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Close", "[", "out", "]"}], "\n", "\"\<polygon.test\>\""}], "Input",
 CellChangeTimes->{{3.561004944434661*^9, 3.561004995954134*^9}, {
  3.561005096985243*^9, 3.56100515818229*^9}, {3.561005260287316*^9, 
  3.561005263209238*^9}, {3.561005493789223*^9, 3.561005508314802*^9}, {
  3.561006336543409*^9, 3.561006342157714*^9}, {3.56103585994246*^9, 
  3.561035864123729*^9}}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"polygon.test\"\>", ",", "31"}], "]"}]], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034242441101*^9}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"polygon.test\"\>", ",", "35"}], "]"}]], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034242443262*^9}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"polygon.test\"\>", ",", "31"}], "]"}]], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034243129523*^9}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"polygon.test\"\>", ",", "31"}], "]"}]], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034243360247*^9}],

Cell[BoxData["\<\"polygon.test\"\>"], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034243362104*^9}],

Cell[BoxData["\<\"polygon.test\"\>"], "Output",
 CellChangeTimes->{3.561005119872868*^9, 3.561005159046536*^9, 
  3.561005203947498*^9, 3.561005264010124*^9, 3.561005510762716*^9, 
  3.561006347235059*^9, 3.561006381150992*^9, 3.561007756678899*^9, 
  3.561034243363976*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Intersect", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a_", ",", "b_", ",", "c_"}], "}"}], ",", "p_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "inters", "}"}], ",", 
    RowBox[{
     RowBox[{"inters", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Intersect", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "b", ",", "c"}], "}"}], ",", "#"}], "]"}], "&"}],
        "/@", "p"}]}], ";", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"inters", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{
           RowBox[{"Length", "[", "x", "]"}], ">", "0"}]}], ",", "1"}], "]"}],
        ",", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"inters", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "0"}], " ", "&"}]}], 
        "]"}]}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.560943817342385*^9, 3.560943887183019*^9}, {
  3.560944393435289*^9, 3.560944416208284*^9}, {3.560944470552959*^9, 
  3.560944544082007*^9}, {3.560945071431046*^9, 3.560945101159057*^9}, {
  3.560945996076667*^9, 3.560946118488964*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"h", "=", "0.020"}], "\[IndentingNewLine]", 
 RowBox[{"w", "=", "0.006"}], "\[IndentingNewLine]", 
 RowBox[{"r", "=", "0.450"}], "\[IndentingNewLine]", 
 RowBox[{"nDetectors", "=", "280"}]}], "Input",
 CellChangeTimes->{{3.560943170455486*^9, 3.560943229846772*^9}, {
  3.560943367037236*^9, 3.560943374283657*^9}, {3.560943902128496*^9, 
  3.560943903422727*^9}, {3.561040815841277*^9, 3.561040818222118*^9}}],

Cell[BoxData["0.02`"], "Output",
 CellChangeTimes->{{3.560943350164565*^9, 3.560943375707428*^9}, 
   3.560943904044239*^9, {3.56103423339126*^9, 3.561034243795304*^9}, 
   3.561040822464641*^9}],

Cell[BoxData["0.006`"], "Output",
 CellChangeTimes->{{3.560943350164565*^9, 3.560943375707428*^9}, 
   3.560943904044239*^9, {3.56103423339126*^9, 3.561034243795304*^9}, 
   3.561040822484888*^9}],

Cell[BoxData["0.45`"], "Output",
 CellChangeTimes->{{3.560943350164565*^9, 3.560943375707428*^9}, 
   3.560943904044239*^9, {3.56103423339126*^9, 3.561034243795304*^9}, 
   3.561040822486696*^9}],

Cell[BoxData["280"], "Output",
 CellChangeTimes->{{3.560943350164565*^9, 3.560943375707428*^9}, 
   3.560943904044239*^9, {3.56103423339126*^9, 3.561034243795304*^9}, 
   3.56104082248859*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"scintilator", "=", 
  RowBox[{"Polygon", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", 
       RowBox[{
        RowBox[{"-", "w"}], "/", "2"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"r", "+", "h"}], ",", 
       RowBox[{
        RowBox[{"-", "w"}], "/", "2"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"r", "+", "h"}], ",", 
       RowBox[{"w", "/", "2"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"r", ",", 
       RowBox[{"w", "/", "2"}]}], "}"}]}], "}"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.560943170455486*^9, 3.560943276474511*^9}}],

Cell[BoxData[
 RowBox[{"Polygon", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0.45`", ",", 
      RowBox[{"-", "0.003`"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.47000000000000003`", ",", 
      RowBox[{"-", "0.003`"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.47000000000000003`", ",", "0.003`"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0.45`", ",", "0.003`"}], "}"}]}], "}"}], "]"}]], "Output",
 CellChangeTimes->{3.560943209376613*^9, 3.560943277824393*^9, 
  3.560943352043206*^9, 3.560943905349899*^9, 3.561034243814431*^9, 
  3.561040825891058*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"detector", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"rotate", "[", 
      RowBox[{"scintilator", ",", 
       RowBox[{"i", " ", "2", " ", 
        RowBox[{"Pi", "/", "nDetectors"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", 
       RowBox[{"nDetectors", "-", "1"}]}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.560943297120489*^9, 3.56094340405133*^9}, {
  3.560943794072009*^9, 3.560943809632383*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Intersect", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "1"}], "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], ",", 
     RowBox[{"1", "/", 
      RowBox[{"Sqrt", "[", "2", "]"}]}], ",", "0.2"}], "}"}], ",", 
   "detector"}], "]"}]], "Input",
 CellChangeTimes->{{3.560944522347573*^9, 3.560944526721614*^9}, {
  3.560944972223154*^9, 3.560944989045326*^9}, {3.56094615434501*^9, 
  3.56094615972664*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "56", "}"}], ",", 
     RowBox[{"{", "156", "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.15713226052963675`", ",", "0.43997497300425586`"}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"0.14735397131384803`", ",", "0.4301966837884671`"}], "}"}]}],
       "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.43019668378846704`"}], ",", 
         RowBox[{"-", "0.147353971313848`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.43997497300425586`"}], ",", 
         RowBox[{"-", "0.15713226052963677`"}]}], "}"}]}], "}"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.560944528575747*^9, 3.560944547362842*^9}, {
   3.560944973243135*^9, 3.560944989822958*^9}, {3.560945062342759*^9, 
   3.560945076977832*^9}, 3.560945499179328*^9, 3.560945543330533*^9, 
   3.560946030588322*^9, {3.560946063791246*^9, 3.560946093459548*^9}, {
   3.560946127075249*^9, 3.560946160557037*^9}, 3.561034244408707*^9, 
   3.56103456856106*^9, 3.561040828656749*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"sdata", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RandomReal", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "r"}], ",", "r"}], "}"}], "/", 
            RowBox[{"Sqrt", "[", "2", "]"}]}], ",", "2"}], "]"}], ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "Pi"}], ",", "Pi"}], "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", "1000", "}"}]}], "]"}], ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ".", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "<", 
        RowBox[{
         RowBox[{"1", "/", "2"}], 
         RowBox[{"r", "^", "2"}]}]}], ")"}], "&"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.560864844891891*^9, 3.56086486860552*^9}, {
  3.560944206970483*^9, 3.560944221530837*^9}, {3.560944354433795*^9, 
  3.560944360824976*^9}, {3.560945486498182*^9, 3.560945492751193*^9}, {
  3.560945526232671*^9, 3.560945538560461*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.560944231560339*^9, 3.560944250919547*^9}, {
  3.560944285273981*^9, 3.560944287358871*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lines", "=", 
   RowBox[{"eventToLine", "/@", "sdata"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.560944261489377*^9, 3.560944289962353*^9}, 
   3.560944363618963*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"inters", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Intersect", "[", 
      RowBox[{"#", ",", "detector"}], "]"}], "&"}], "/@", "lines"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.560944522347573*^9, 3.560944526721614*^9}, {
  3.560944565619171*^9, 3.560944575827791*^9}, {3.560944641839724*^9, 
  3.560944689630562*^9}, {3.560944762969132*^9, 3.560944821432324*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lengths", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], "/@", "inters"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.561036696484015*^9, 3.561036730740998*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"exp", "=", 
   RowBox[{"Flatten", "/@", 
    RowBox[{"Zip", "[", 
     RowBox[{"sdata", ",", "lengths", ",", "inters"}], "]"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.561036754059039*^9, 3.561036787305256*^9}}],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.561036776261737*^9, 3.561036777174823*^9}, {
  3.561036843560309*^9, 3.561036844520248*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.22402511836483466`", ",", "0.1746700899926763`", ",", 
   "0.11940829071407731`", ",", "2", ",", "10", ",", "61", ",", 
   "0.42585201868700107`", ",", "0.19888509330976412`", ",", 
   "0.4092889270086048`", ",", "0.19689786901363024`", ",", 
   RowBox[{"-", "0.45386290073122126`"}], ",", "0.09333771752487088`", ",", 
   RowBox[{"-", "0.46080755438350934`"}], ",", "0.09250450445487007`"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.561036777511115*^9, 3.561036789393654*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"out", "=", 
  RowBox[{
  "OpenWrite", "[", "\"\<detector_ring.test\>\"", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"out", ",", 
   RowBox[{"{", 
    RowBox[{"r", ",", "nDetectors", ",", "w", ",", "h", ",", 
     RowBox[{"sdata", "//", "Length"}]}], "}"}], ",", "\"\<List\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Write", "[", "out", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{"out", ",", "exp", ",", "\"\<Table\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Close", "[", "out", "]"}]}], "Input",
 CellChangeTimes->{{3.560943895654461*^9, 3.560943898723568*^9}, {
  3.561035874134228*^9, 3.561035938217992*^9}, {3.561036003363874*^9, 
  3.561036031203663*^9}, {3.56103685354828*^9, 3.561036868132576*^9}, {
  3.561036904444858*^9, 3.561036921788223*^9}}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"detector_ring.test\"\>", ",", "106"}], "]"}]], "Output",
 CellChangeTimes->{3.561036870422187*^9, 3.561036923699293*^9, 
  3.561040993985585*^9}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"detector_ring.test\"\>", ",", "106"}], "]"}]], "Output",
 CellChangeTimes->{3.561036870422187*^9, 3.561036923699293*^9, 
  3.561040994065571*^9}],

Cell[BoxData[
 RowBox[{"OutputStream", "[", 
  RowBox[{"\<\"detector_ring.test\"\>", ",", "106"}], "]"}]], "Output",
 CellChangeTimes->{3.561036870422187*^9, 3.561036923699293*^9, 
  3.561040994304216*^9}],

Cell[BoxData["\<\"detector_ring.test\"\>"], "Output",
 CellChangeTimes->{3.561036870422187*^9, 3.561036923699293*^9, 
  3.561040994306359*^9}]
}, Open  ]]
},
WindowSize->{1075, 986},
WindowMargins->{{Automatic, 12}, {35, Automatic}},
FrontEndVersion->"8.0 for Linux x86 (32-bit) (November 7, 2010)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 183, 3, 50, "Input"],
Cell[765, 27, 168, 2, 30, "Output"]
}, Open  ]],
Cell[948, 32, 1634, 50, 69, "Input"],
Cell[2585, 84, 1989, 52, 88, "Input"],
Cell[CellGroupData[{
Cell[4599, 140, 412, 13, 30, "Input"],
Cell[5014, 155, 205, 4, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5256, 164, 432, 13, 30, "Input"],
Cell[5691, 179, 442, 13, 30, "Output"]
}, Open  ]],
Cell[6148, 195, 129, 2, 30, "Input"],
Cell[6280, 199, 646, 19, 30, "Input"],
Cell[6929, 220, 92, 1, 30, "Input"],
Cell[7024, 223, 564, 16, 30, "Input"],
Cell[7591, 241, 1161, 33, 88, "Input"],
Cell[CellGroupData[{
Cell[8777, 278, 592, 18, 30, "Input"],
Cell[9372, 298, 422, 13, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9831, 316, 700, 16, 30, "Input"],
Cell[10534, 334, 482, 10, 374, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11053, 349, 950, 25, 69, "Input"],
Cell[12006, 376, 562, 15, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12605, 396, 531, 15, 30, "Input"],
Cell[13139, 413, 7756, 130, 368, 266, 6, "CachedBoxData", "BoxData", \
"Output"]
}, Open  ]],
Cell[20910, 546, 217, 4, 30, "Input"],
Cell[21130, 552, 529, 15, 30, "Input"],
Cell[21662, 569, 181, 4, 30, "Input"],
Cell[21846, 575, 256, 8, 30, "Input"],
Cell[22105, 585, 200, 5, 30, "Input"],
Cell[22308, 592, 319, 8, 30, "Input"],
Cell[CellGroupData[{
Cell[22652, 604, 144, 3, 30, "Input"],
Cell[22799, 609, 470, 12, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23306, 626, 919, 20, 145, "Input"],
Cell[24228, 648, 336, 6, 30, "Output"],
Cell[24567, 656, 336, 6, 30, "Output"],
Cell[24906, 664, 336, 6, 30, "Output"],
Cell[25245, 672, 336, 6, 30, "Output"],
Cell[25584, 680, 274, 4, 30, "Output"],
Cell[25861, 686, 274, 4, 30, "Output"]
}, Open  ]],
Cell[26150, 693, 1224, 35, 50, "Input"],
Cell[CellGroupData[{
Cell[27399, 732, 434, 7, 88, "Input"],
Cell[27836, 741, 195, 3, 30, "Output"],
Cell[28034, 746, 196, 3, 30, "Output"],
Cell[28233, 751, 195, 3, 30, "Output"],
Cell[28431, 756, 192, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28660, 764, 656, 21, 30, "Input"],
Cell[29319, 787, 600, 16, 30, "Output"]
}, Open  ]],
Cell[29934, 806, 496, 13, 30, "Input"],
Cell[CellGroupData[{
Cell[30455, 823, 463, 13, 30, "Input"],
Cell[30921, 838, 1228, 33, 50, "Output"]
}, Open  ]],
Cell[32164, 874, 1243, 36, 30, "Input"],
Cell[33410, 912, 141, 2, 30, "Input"],
Cell[33554, 916, 202, 5, 30, "Input"],
Cell[33759, 923, 407, 10, 30, "Input"],
Cell[34169, 935, 288, 9, 30, "Input"],
Cell[34460, 946, 252, 7, 30, "Input"],
Cell[CellGroupData[{
Cell[34737, 957, 141, 2, 30, "Input"],
Cell[34881, 961, 524, 10, 50, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[35442, 976, 846, 19, 107, "Input"],
Cell[36291, 997, 205, 4, 30, "Output"],
Cell[36499, 1003, 205, 4, 30, "Output"],
Cell[36707, 1009, 205, 4, 30, "Output"],
Cell[36915, 1015, 142, 2, 30, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
